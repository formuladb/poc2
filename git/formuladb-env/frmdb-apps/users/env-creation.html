<!DOCTYPE html>
<html>

<head>
    <title>FormulaDB - Login</title>
</head>

<body>
    <style>
        a.disabled {
            pointer-events: none;
            cursor: default;
        }
    </style>
    <header class="header-global">
        <nav id="navbar-main" class="navbar navbar-main navbar-expand-lg navbar-transparent navbar-light headroom">
            <div class="container">
                <a class="btn bg-primary mr-lg-5" href="index.html"><img src="/formuladb-env/frmdb-apps/formuladb-io/static/logo.png" style="height: 32px"></a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar_global" aria-controls="navbar_global"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="navbar-collapse collapse" id="navbar_global">
                    <ul class="navbar-nav align-items-lg-center ml-lg-auto">
                        <li class="nav-item">
                            <a class="nav-link nav-link-icon" href="https://www.facebook.com/formuladb" target="_blank" data-toggle="tooltip"
                                title="Like us on Facebook">
                                <i class="frmdb-i-facebook-square"></i>
                                <span class="nav-link-inner--text d-lg-none">Facebook</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link nav-link-icon" href="https://www.instagram.com/formuladb" target="_blank" data-toggle="tooltip"
                                title="Follow us on Instagram">
                                <i class="frmdb-i-instagram"></i>
                                <span class="nav-link-inner--text d-lg-none">Instagram</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link nav-link-icon" href="https://twitter.com/formuladb" target="_blank" data-toggle="tooltip"
                                title="Follow us on Twitter">
                                <i class="frmdb-i-twitter-square"></i>
                                <span class="nav-link-inner--text d-lg-none">Twitter</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link nav-link-icon" href="https://github.com/formuladb" target="_blank" data-toggle="tooltip"
                                title="Star us on Github">
                                <i class="frmdb-i-github"></i>
                                <span class="nav-link-inner--text d-lg-none">Github</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <main>
        <section class="section section-lg">
            <div class="container pt-lg-md">
                <div class="row justify-content-center">
                    <div class="col-1 min-vh-50 mx-4 d-flex flex-column justify-content-center">
                        <div class="spinner-border m-5" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                    </div>
                    <div class="col min-vh-50 d-flex flex-column justify-content-center">
                        <h3>Creating your environment</h3>
                        <div id="status">This may take a few minutes...</div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        (async function () {
            let urlParams = new URLSearchParams(window.location.search);
            let envName = urlParams.get('NEW_ENV_NAME');
            for (let step = 0; step < 60; step++) {
                try {
                    const res = await fetch(`/formuladb-api/check-env/${envName}`);
                    if (200 == res.status) {
                        console.log("env ready...");
                        document.querySelector('#status').innerHTML = 
                            `<span class="text-success">Env ready:</span> <a href="https://${envName}.formuladb.io">https://${envName}.formuladb.io</a>`;
                        document.querySelector('#link-to-env').classList.remove('disabled');
                    }
                } catch (error) {
                    console.log(`Fetch failed with error ${error}. Retrying ...`);
                }
                await new Promise(resolve => setTimeout(resolve, 4000));
            }
            document.querySelector('#status').innerHTML = 
                            `<span class="text-danger">Something went wrong!</span> <a href="../formuladb-io/contact.html">Please contact support.</a>`;

        })();
    </script>

    <div data-frmdb-fragment="_footer.html"></div>
    <div data-frmdb-fragment="_scripts.html"></div>
</body>

</html>